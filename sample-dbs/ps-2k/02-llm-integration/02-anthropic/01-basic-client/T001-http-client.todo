---
id: P2.M2.E1.T001
title: Set up HTTP client with Req
status: done
estimate_hours: 0.5
complexity: low
priority: high
depends_on: []
tags:
- llm
- anthropic
- http
- client
claimed_by: cli-user
claimed_at: '2026-02-05T10:44:33.296883'
started_at: '2026-02-05T10:44:33.296883'
completed_at: '2026-02-05T10:47:55.385899'
---

# Set up HTTP client with Req

Create the base HTTP client using Req library for Anthropic API communication.

## Requirements

- [ ] Add `{:req, "~> 0.4"}` dependency to mix.exs
- [ ] Create `PagServer.LLM.Providers.Anthropic` module
- [ ] Configure base URL: `https://api.anthropic.com`
- [ ] Set API version header: `anthropic-version: 2023-06-01`
- [ ] Add timeout configuration (default: 60s)
- [ ] Add basic unit test for client initialization

## Acceptance Criteria

- [ ] `mix deps.get` fetches Req successfully
- [ ] Client module compiles without warnings
- [ ] Can initialize client with default configuration
- [ ] Tests pass with >85% coverage
- [ ] `mix credo --strict` passes

## Context

**Plan References**:
- `.plan/2026-02-05-velvet-cascade/architecture.md` Section 4.4 (LLM Domain)
- `ref-projects/anthropix/lib/anthropix.ex` - Reference implementation

**Key Points**:
- Use Req library (modern HTTP client with middleware support)
- Follow Provider behaviour pattern from P2.M1
- Keep file size <300 LoC (architecture guideline)

## Notes

The Anthropic API requires:
- Header: `x-api-key: <api_key>`
- Header: `anthropic-version: 2023-06-01`
- Header: `content-type: application/json`

Req configuration example:
```elixir
defmodule PagServer.LLM.Providers.Anthropic do
  @base_url "https://api.anthropic.com"
  @api_version "2023-06-01"
  
  def new(api_key) do
    Req.new(
      base_url: @base_url,
      headers: [
        {"x-api-key", api_key},
        {"anthropic-version", @api_version},
        {"content-type", "application/json"}
      ],
      receive_timeout: 60_000
    )
  end
end
```

Reference anthropix for API patterns.
