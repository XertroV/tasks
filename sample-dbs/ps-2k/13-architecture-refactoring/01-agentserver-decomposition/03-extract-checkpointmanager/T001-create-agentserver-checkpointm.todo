---
id: P13.M1.E3.T001
title: Create AgentServer.CheckpointManager module
status: done
estimate_hours: 1.0
complexity: medium
priority: medium
depends_on: []
tags: []
claimed_by: cli-user
claimed_at: '2026-02-13T11:13:02.265002+00:00'
started_at: '2026-02-13T11:13:02.265002+00:00'
completed_at: '2026-02-13T11:27:16.626328+00:00'
duration_minutes: 14.239355100000001
---

# Create AgentServer.CheckpointManager module

## Description

Create a dedicated `AgentServer.CheckpointManager` module to coordinate checkpoint lifecycle operations including scheduling, persistence triggers, and recovery orchestration. Note: This is separate from `CheckpointStore` which handles the actual persistence.

## Acceptance Criteria
- [ ] Create `lib/pag_server/agents/checkpoint_manager.ex`
- [ ] Implement `schedule_checkpoint/1` for checkpoint timer management
- [ ] Implement `should_checkpoint?/2` to determine if checkpoint is needed
- [ ] Implement `prepare_checkpoint_state/1` to extract serializable state
- [ ] Add configuration for checkpoint interval (default 5 minutes)
- [ ] Module documentation with usage examples
- [ ] Tests pass
- [ ] Lint passes

## Context
- Related files: `lib/pag_server/agents/checkpoint_store.ex` (persistence layer)
- Related files: `lib/pag_server/agents/agent_server.ex` (lines 82-86, 873-877, 1653-1654)
- Part of epic: P13.M1.E3 - Extract CheckpointManager


## Sibling Batch Instructions

**Batch mode**: siblings (same epic: P13.M1.E3)
**Agent**: cli-user
**Date**: 2026-02-13 11:13 UTC
**Sibling tasks**: P13.M1.E3.T002, P13.M1.E3.T003

**Instructions**:
This task is part of a sibling batch from the same epic.
Spawn ONE subagent to implement ALL sibling tasks sequentially.
Work through tasks in order: P13.M1.E3.T001 → P13.M1.E3.T002 → P13.M1.E3.T003
Mark each done individually after completion.

**Task files**:
- P13.M1.E3.T001: .tasks/13-architecture-refactoring/01-agentserver-decomposition/03-extract-checkpointmanager/T001-create-agentserver-checkpointm.todo
- P13.M1.E3.T002: .tasks/13-architecture-refactoring/01-agentserver-decomposition/03-extract-checkpointmanager/T002-migrate-checkpoint-persistence.todo
- P13.M1.E3.T003: .tasks/13-architecture-refactoring/01-agentserver-decomposition/03-extract-checkpointmanager/T003-add-unit-tests-for-checkpointm.todo
