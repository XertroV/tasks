---
id: B146
title: 'threads: add child vs sibling/cousin thread spawn modes'
status: done
estimate_hours: 1.0
complexity: medium
priority: medium
depends_on: []
tags:
- threads
- spawn_subagent
- session-forking
claimed_by: cli-user
claimed_at: '2026-02-19T01:13:19.241600+00:00'
started_at: '2026-02-19T01:13:19.241600+00:00'
completed_at: '2026-02-19T01:24:18.928048+00:00'
duration_minutes: 10.994773883333332
---
Currently thread spawning always creates a child thread. We need to distinguish between two spawn modes:

- child thread: subordinate to the parent, parent may await it, parent session is aware of it, cleanup is tied to parent lifetime
- sibling/cousin thread: fully independent from the origin thread once spawned; goes off on its own, not expected to report back, lifecycle is independent

This maps to opencode's concept of forked sessions vs independent sessions. The distinction matters for:
- Resource/lifetime management (child cleaned up with parent vs independent GC)
- Whether the spawning agent can/should await the result
- Routing and audit trail

Acceptance criteria:
- New parameter on spawn tool (e.g. mode: 'child' | 'sibling', default: 'child')
- Child mode: session parented to spawner, eligible for await, cleaned up with parent
- Sibling mode: session is independent, not awaitable by spawner, own lifecycle
- Tests covering both modes and their lifecycle differences

## Delegation Instructions

**Delegated to subagent by**: cli-user (primary agent)
**Delegation date**: 2026-02-19 01:13 UTC
**Primary task**: B145 - threads: support system prompt override and agent template lookup on session spawn

**Instructions**:
This task was claimed as part of a multi-task batch. The primary agent (cli-user)
should spawn a subagent to complete this task in parallel.

**Recommended approach**:
1. Use the Task tool with subagent_type to create a dedicated agent
2. Provide context from this task file as the prompt
3. Grant necessary tools for task completion
4. Monitor subagent progress
5. Aggregate results upon completion

**Independence verification**:
- Different epic: ✓ (None vs None)
- No dependency chain: ✓ (verified at claim time)
