---
id: B147
title: 'threads: add synchronous await mode (threads await <thread-id>)'
status: done
estimate_hours: 1.0
complexity: medium
priority: medium
depends_on: []
tags:
- threads
- spawn_subagent
- synchronous
claimed_by: cli-user
claimed_at: '2026-02-19T01:13:19.242825+00:00'
started_at: '2026-02-19T01:13:19.242825+00:00'
completed_at: '2026-02-19T01:24:21.176513+00:00'
duration_minutes: 11.032227866666666
---
Currently thread spawning is always async — the spawning agent gets a directive and continues. We need a synchronous mode where the spawning agent blocks until the child thread completes and gets its output back.

Implementation approach: emulate synchronous behaviour — the agent either:
a) passes a flag on spawn (e.g. await: true) which makes the tool call block until the child completes and returns its output inline, OR
b) calls a separate tool (e.g. threads_await / await_thread) passing the thread-id, which blocks until that thread completes and returns its final output

Option (b) is more composable: the agent spawns, does other work, then explicitly awaits when it needs the result. This matches opencode's synchronous task tool behaviour.

Acceptance criteria:
- New tool or parameter for awaiting a thread by ID
- Returns the thread's final text output once complete
- Handles timeout (configurable, with error on timeout)
- Handles already-completed threads (returns cached output immediately)
- Handles failed threads (surfaces error to caller)
- Tests covering: await-before-complete, await-after-complete, timeout, failure

## Delegation Instructions

**Delegated to subagent by**: cli-user (primary agent)
**Delegation date**: 2026-02-19 01:13 UTC
**Primary task**: B145 - threads: support system prompt override and agent template lookup on session spawn

**Instructions**:
This task was claimed as part of a multi-task batch. The primary agent (cli-user)
should spawn a subagent to complete this task in parallel.

**Recommended approach**:
1. Use the Task tool with subagent_type to create a dedicated agent
2. Provide context from this task file as the prompt
3. Grant necessary tools for task completion
4. Monitor subagent progress
5. Aggregate results upon completion

**Independence verification**:
- Different epic: ✓ (None vs None)
- No dependency chain: ✓ (verified at claim time)
