---
id: P4.M1.E3.T003
title: Format for OpenAI tools
status: done
estimate_hours: 0.5
complexity: low
priority: medium
depends_on:
- P4.M1.E3.T001
tags:
- tools
- schema
- openai
claimed_by: cli-user
claimed_at: '2026-02-05T22:24:50.194519'
started_at: '2026-02-05T22:24:50.194519'
completed_at: '2026-02-05T22:29:36.883925'
duration_minutes: 4.7781566
---

# Format for OpenAI tools

Add converter to format tools for OpenAI API (GPT-4, etc.).

## Requirements

- [x] Add `to_openai_format(tool_schema)` function to SchemaBuilder
- [x] Use `parameters` field (OpenAI standard)
- [x] Include `type: "function"` wrapper
- [x] Support `strict: true` for structured outputs
- [x] Return list of tool definitions in OpenAI format

## Acceptance Criteria

- [x] Output matches OpenAI API tool definition format
- [x] Compatible with OpenAI SDK expectations
- [x] Supports strict mode for validated outputs
- [x] Test validates against OpenAI API schema
- [x] Integration test with mock OpenAI client

## Context

**Plan References**:
- `.plan/2026-02-05-velvet-cascade/integrations.md` OpenAI API section

**Key Points**:
- OpenAI uses `parameters` instead of `input_schema`
- Tools wrapped in `{type: "function", function: {...}}`
- Supports `strict: true` for JSON mode validation
- Compatible with GPT-4, GPT-3.5, and future models

## Notes

OpenAI format:
```elixir
def to_openai_format(%ToolSchema{} = schema, opts \\ []) do
  strict = Keyword.get(opts, :strict, false)
  
  function_def = %{
    name: schema.name,
    description: schema.description,
    parameters: schema.parameters
  }
  
  function_def = if strict do
    Map.put(function_def, :strict, true)
  else
    function_def
  end
  
  %{
    type: "function",
    function: function_def
  }
end

def to_openai_tools(tool_schemas, opts \\ []) do
  Enum.map(tool_schemas, &to_openai_format(&1, opts))
end
```

Example output:
```json
[
  {
    "type": "function",
    "function": {
      "name": "read_file",
      "description": "Read file contents",
      "parameters": {
        "type": "object",
        "properties": {
          "path": {"type": "string"}
        },
        "required": ["path"]
      },
      "strict": true
    }
  }
]
```

Reference: https://platform.openai.com/docs/guides/function-calling
